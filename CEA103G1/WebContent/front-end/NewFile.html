<!DOCTYPE html>
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=BIG5">
<title>搜尋營區</title>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://unpkg.com/ionicons@5.4.0/dist/ionicons.js"></script>
</head>
<body>
	<div class="container" id="form">
		<div class="row">
			<div class="col-sm-3">
				<FORM method="get" id="condition" onsubmit="return false"
					accept-charset="big5">
					<!-- 		縣市:<select id="county" name="county"></select> -->
					縣市:<input type="type" name="county"> 入住日期:<input
						name="startdate" id="startdate" type="text"> 退房日期:<input
						name="enddate" id="enddate" type="text"> 人數:<input
						name="people" id="people" type="number"><input
						type="hidden" name="action" value="search"><input
						type="button" id="idForm" value="搜尋">
				</FORM>
				<FORM id="feature"></FORM>
				<FORM id="budget">
					<input type="radio" name="budget" value="1000">1000<input
						type="radio" name="budget" value="1500">1500<input
						type="radio" name="budget" value="2000">2000<input
						type="radio" name="budget" value="2500">2500<input
						type="radio" name="budget" value="3000">3000<input
						type="radio" name="budget" value="3500">3500
				</FORM>
			</div>
		</div>
	</div>

	<div class="container">
		<div class="row">
			<div class="col-sm-9" id="featurelist"></div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-sm-9" id="all"></div>
		</div>
	</div>
	<script>
		$.ajax({
			type : "GET",
			dataType : "json",
			url : "http://localhost:8081/CEA103G1/feature_list/featurelist.do?action=getAll",
			success : function(data) {
				showFeature(data);
			}
		});
		$.ajax({
			type : "GET",
			dataType : "json",
			url : "http://localhost:8081/CEA103G1/campsite/CampInfo.do?action=getall",
			success : function(data) {
				showAll(data);
			}
		});
	    $("#idForm").click(function(){
			$('#all').children().remove();
			$.ajax({
				type : "GET",
				cache : "false",
				dataType : "json",
				url : "http://localhost:8081/CEA103G1/ValidPlace.do",
				data : $('#condition').serialize(), // serializes the form's elements.
				success : function(data) {
					showNames(data);
				}
			});
		});// avoid to execute the actual submit of the form.
		
		function showFeature(data){
			for (i in data) {
				let html;
				html =`<button value="${data[i].camp_fl_no}" onclick="findWithFeature(this.value)">${data[i].camp_fl_name}</button>`;
				$('#featurelist').append(html);
			}
		}
		function findWithFeature(e) {
			$('#all').children().remove();
			$.ajax({
				type : "GET",
				dataType : "json",
				url : "http://localhost:8081/CEA103G1/feature_list/featurelist.do?action=getCamp&camp_fl_no=" + e,
				success : function(data) {
					showAll(data);
				}
			});
		}
		function showAll(data) {
			var a = JSON.stringify(data);
			console.log(a);
			for (i in data) {
				let html;	
				var href=`campsite/listOneCamp.html?camp_no=${data[i].camp_no}&action=getone`;
				html = `<div><a id="${data[i].camp_no}" style="text-decoration:none;">${data[i].camp_name}
					</a><ion-icon id="fav" name="bookmark-outline"></ion-icon><p>地址:${data[i].address}</p><p>最低價:${data[i].low_pc}</p></div><hr>`;
				$('#all').append(html);
				$(`#${data[i].camp_no}`).attr("href",href);
				$(`#${data[i].camp_no}`).attr("target","_blank");
			}
		}
		function showNames(data) {
			var a = JSON.stringify(data);
			console.log(a);
			for (i in data) {
				let html;
				if (i) {	
					var href=`campsite/listOneCamp.html?camp_no=${data[i].camp_no}&startdate=` + $('#startdate').val() + "&enddate=" + $('#enddate').val() + "&people=" + $('#people').val();
					html = `<div><a id="${data[i].camp_no}" style="text-decoration:none;">${data[i].camp_name}
						</a><ion-icon id="fav" name="bookmark-outline"></ion-icon><p>地址:${data[i].address}</p><p>最低價:${data[i].low_pc}</p></div><hr>`;
				} else {
					html = "<center>所有營區皆已滿</center>";
				}
				$('#all').append(html);
				$(`#${data[i].camp_no}`).attr("href",href);
				$(`#${data[i].camp_no}`).attr("target","_blank");
			}
		}
	</script>
</body>
</html>