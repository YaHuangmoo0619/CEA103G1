<!DOCTYPE html>
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=BIG5">
<title>營區資訊</title>
<link rel="icon" href="campionLogoIcon.png" type="image/png">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
	integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
	crossorigin="anonymous">
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/ionicons@5.4.0/dist/ionicons.js"></script>
<link   rel="stylesheet" type="text/css" href="/CEA103G1/datetimepicker/jquery.datetimepicker.css" />
<style>
.w3-content{position:relative;margin-top:0em;}
.w3-btn,.w3-button{border:none;display:inline-block;outline:0;padding:8px 16px;vertical-align:middle;overflow:hidden;text-decoration:none;color:inherit;background-color:inherit;text-align:center;cursor:pointer;white-space:nowrap}
.w3-btn,.w3-button{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none} 
.w3-disabled,.w3-btn:disabled,.w3-button:disabled{cursor:not-allowed;opacity:0.3}.w3-disabled *,:disabled *{pointer-events:none}
.w3-bar-block .w3-dropdown-hover .w3-button,.w3-bar-block .w3-dropdown-click .w3-button{width:100%;text-align:left;padding:8px 16px}
.w3-button:hover{color:#000!important;background-color:#ccc!important}

.w3-content button {
position: absolute;
top: 32%;
}

.w3-display-right {right:0}
.w3-display-left {left:0}
.confirm {
	margin: 2px;
	background-color: #80c344;
	color: #4e5452;
	padding: 5px 10px;
	border-radius: 5px;
	border: none;
	font-weight: 999;
	background-color: #80c344;
}
.formtoplace {
	width:20%;
	display:inline-block;
	margin:2px;
}
.confirm:hover {
	background-color: #4B7F52;
	color: #80c344;
	cursor: pointer;
}

div.left {
	margin-top: 20px;
	/* 	margin-right: 100%; */
}

div.right {
	background-color: #fff;
	margin-top: 20px;
	/* 	padding: 50px 50px; */
	border-radius: 5px;
}

html, body {
	margin: 0;
	padding: 0;
	/*background-color: #4e5452;*/
	background-color: #fff;
	color: #4B7F52;
}

div.fixedTop {
	background-color: #eee;
	position: relative;
	z-index: 10;
	left: 50%;
	transform: translateX(-50%);
	width: 100%;
	text-align: center;
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 0px 15px;
}

img.logo {
	width: 150px;
	margin: 10px;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: none;
}

a.button{
	margin: 5px;
}

form.form-inline {
	display: inline;
	border: none;
}

img.searchIcon {
	display: none;
}

img.cart {
	width: 30px;
	margin: 10px;
}

img.cart:hover {
	cursor: pointer;
}

img.announcement{
	width: 30px;
	margin: 10px;
}
img.announcement:hover{
	cursor: pointer;
}

img.menu {
	width: 40px;
	margin: 10px;
	display: none;
}

img.menu:hover {
	cursor: pointer;
}

img.person {
	width: 40px;
	margin: 10px;
	right: 1px;
}

img.person:hover {
	cursor: pointer;
}

@media screen and (max-width: 575px) {
	container {
		width: 100%;
	}
	form.form-inline {
		display: none;
	}
	form.secSearch {
		display: none;
	}
	img.searchIcon {
		display: inline;
		width: 30px;
		margin: 0px;
	}
	img.searchIcon:hover {
		cursor: pointer;
	}
	div.btn-group {
		display: none;
	}
	img.menu {
		width: 30px;
		display: inline-block;
	}
	div.sec {
		display: none;
		background-color: #eee;
	}
}

@media ( min-width : 576px) and (max-width: 767px) {
	container {
		width: 540px;
		margin: 0px auto;
	}
	form.form-inline {
		display: none;
	}
	form.secSearch {
		display: none;
	}
	img.searchIcon {
		display: inline;
		width: 30px;
		margin: 0px;
	}
	img.searchIcon:hover {
		cursor: pointer;
	}
	div.btn-group {
		display: none;
	}
	img.menu {
		width: 30px;
		display: inline-block;
	}
	div.sec {
		display: none;
		background-color: #eee;
	}
}

@media ( min-width : 768px) and (max-width: 991px) {
	container {
		width: 720px;
		margin: 0px auto;
	}
	form.form-inline {
		display: none;
	}
	form.secSearch {
		display: none;
	}
	img.searchIcon {
		display: inline;
		width: 30px;
		margin: 0px;
	}
	img.searchIcon:hover {
		cursor: pointer;
	}
	div.btn-group {
		display: none;
	}
	img.menu {
		width: 30px;
		display: inline-block;
	}
	div.sec {
		display: none;
		background-color: #eee;
	}
}

@media ( min-width : 992px) and (max-width: 1199px) {
	container {
		width: 960px;
		margin: 0px auto;
	}
	div.menuForButton {
		display: none;
	}
	div.forSearch {
		display: none;
	}
}

@media ( min-width : 1200px) {
	container {
		width: 1140px;
		margin: 0px auto;
	}
	div.menuForButton {
		display: none;
	}
	div.forSearch {
		display: none;
	}
}

table{
  width:100%;
  table-layout: fixed;
}
.tbl-header{
  background-color: rgba(255,255,255,0.3);
 }
.tbl-content{
  height:300px;
  overflow-x:auto;
  margin-top: 0px;
  border: 1px solid rgba(255,255,255,0.3);
}
th{
  padding: 20px 15px;
  text-align: left;
  font-weight: 500;
  font-size: 14px;
/*   color: #fff; */
  text-transform: uppercase;
}
td{
  padding: 15px;
  text-align: left;
  vertical-align:middle;
  font-weight: 300;
  font-size: 13px;
/*   color: #fff; */
/*   border-bottom: solid 1px rgba(255,255,255,0.1); */
  border-bottom: solid 1px #80c344;
}
#map {
	width: 330px;
	height: 220px;
	margin: 10px;
}
</style>
</head>
<body>
	<div class="fixedTop">
		<div>
			<a href="/CEA103G1/campion_front.jsp"> <img src="/CEA103G1/front-images/campionLogoLong.png" class="logo">
			</a>
<!-- 			<form class="form-inline my-2 my-lg-0"> -->
<!-- 				<input class="form-control mr-sm-2" type="search" -->
<!-- 					placeholder="營位/商品/文章" aria-label="Search"> -->
<!-- 				<button class="btn btn-outline-success my-2 my-sm-0" type="submit">搜尋</button> -->
<!-- 			</form> -->
		</div>
		<div>
<!--  			<img src="/CEA103G1/front-images/search-circle-outline.svg" id="searchIcon" class="searchIcon"> -->
			<div class="btn-group" role="group" aria-label="Basic example">
				<a class="button" href="/CEA103G1/front-end/campsite/listAllCamp.html"><button type="button" class="btn btn-secondary">露營</button></a>
				<a class="button" href="/CEA103G1/front-end/article/listAllArticle.jsp"><button type="button" class="btn btn-secondary">論壇</button></a>
				<a class="button" href="/CEA103G1/front-end/product/listAllProduct.jsp"><button type="button" class="btn btn-secondary">商城</button></a>
			</div>
			<img src="/CEA103G1/front-images/cart-outline.svg" class="cart">
			<a href="/CEA103G1/front-end/announcement/listAllAnnouncement.jsp"><img src="/CEA103G1/front-images/megaphone-outline.svg" class="announcement"></a>
			<div id="havent" class="btn-group" role="group" aria-label="Basic example">
				<a class="button" href="/CEA103G1/campion_campsiteOwner.jsp"><button type="button" class="btn btn-outline-secondary">營主</button></a>
				<a class="button" href="/CEA103G1/front-end/member/register.jsp"><button type="button" class="btn btn-outline-secondary">註冊</button></a>
				<a class="button" href="/CEA103G1/front-end/member/login.jsp"><button type="button" class="btn btn-outline-secondary">登入</button></a>
<!-- 				<a class="button" href=""><button type="button" class="btn btn-outline-secondary">FAQ</button></a> -->
<!-- 				<a class="button" href=""><button type="button" class="btn btn-outline-secondary">聯絡我們</button></a> -->
			</div>
			<img src="/CEA103G1/front-images/menu-outline.svg" id="menu" class="menu">
				<a id="have" href="/CEA103G1/front-end/member_mail/listAllMember_mail.jsp">
					<div style="position:relative;display:inline;">
						<img src="/CEA103G1/front-images/mail-outline.svg" class="announcement">
					</div>
				</a>
				<a id="have1" href="/CEA103G1/front-end/personal_system_notify/listAllPersonal_system_notify.jsp">
					<div style="position:relative;display:inline;">
						<img src="/CEA103G1/front-images/notifications-outline.svg" class="announcement">
						<div style="background-color: red; color: #fff; width:20px; height:20px;border-radius: 50%; position:absolute; font-size:0.5em;display:inline; right:20%; bottom:50%;"  id="countNoReadNotify"></div>
					</div>
				</a>
				<a id="have2" class="button" href="/CEA103G1/member/member.do?action=logout"><button type="button" class="btn btn-outline-secondary">登出</button></a>
				<a id="have3" href="/CEA103G1/front-end/member/viewMember.jsp"><div id="showPerson" class="person" style="display:inline;border-radius:50%;"></div></a>
		</div>
	</div>

	<div class="forSearch">
		<form class="form-inline secSearch my-2 my-lg-0">
			<input class="form-control mr-sm-2" type="search"
				placeholder="營位/商品/文章" aria-label="Search">
			<button class="btn btn-outline-success my-2 my-sm-0" type="submit">搜尋</button>
		</form>
	</div>
	<div class="menuForButton">
		<div class="btn-group sec" role="group" aria-label="Basic example">
			<a class="button" href="/CEA103G1/front-end/campsite/listAllCamp.html"><button type="button" class="btn btn-secondary">露營</button></a>
			<a class="button" href="/CEA103G1/front-end/article/listAllArticle.jsp"><button type="button" class="btn btn-secondary">論壇</button></a>
			<a class="button" href="/CEA103G1/front-end/product/listAllProduct.jsp"><button type="button" class="btn btn-secondary">商城</button></a>
		</div>
		<div id="havent2" class="btn-group sec" role="group" aria-label="Basic example">
			<a class="button" href="/CEA103G1/campion_campsiteOwner.jsp"><button type="button" class="btn btn-outline-secondary">營主</button></a>
			<a class="button" href="/CEA103G1/front-end/member/register.jsp"><button type="button" class="btn btn-outline-secondary">註冊</button></a>
			<a class="button" href=""><button type="button" class="btn btn-outline-secondary">登入</button></a>
<!-- 			<a class="button" href=""><button type="button" class="btn btn-outline-secondary">FAQ</button></a> -->
<!-- 			<a class="button" href=""><button type="button" class="btn btn-outline-secondary">聯絡我們</button></a> -->
		</div>
	</div>
	<div style="margin-top:15px;text-align:center;">
		<FORM method="get" id="condition" onsubmit="return false"
			accept-charset="big5">
			<!-- 		縣市:<select id="county" name="county"></select> -->
			縣市: <select name="c" id="c"><option value="不拘">不拘</option></select> 入住日期: <input
				name="st" id="st" type="text"> 退房日期: <input
				name="ed" id="ed" type="text"> 人數: <input
				name="p" id="p" type="number"> <input
				type="hidden" name="action" value="search"> <input
				type="button" id="backtobrowse" value="重新查詢" class="btn btn-outline-success my-2 my-sm-0">
		</FORM>
		<hr>
	</div>
	<div class="container" style="margin-left: 0;margin-top: 0;margin-right: 0;">
		<div class="row">
			<div class="left col-4" style="border-right:solid 1px #DDDDDD;">
				<div id="map"></div>
				<div id="spot"><h3>附近景點</h3></div>
			</div>
			<div class="right col-8">
				<div>
					<h1 id="title"></h1>
					<label><ion-icon id="fav" name="bookmark-outline"
							size="large" style="cursor: pointer;"></ion-icon></label>
				</div>
				<div id="featurelist"></div>
				<div id="addrblock">
					<div id="address" style="display: inline-block;"></div>
					<div id="location" style="display: inline-block;"></div>
				</div>
				<div id="photo" style="height:400px;" class="w3-content">
					<button class="w3-button w3-black w3-display-left" onclick="plusDivs(-1)" style="absolute; top:44%;">&#10096;</button>
 					<button class="w3-button w3-black w3-display-right" onclick="plusDivs(1)" style="absolute; top:44%;">&#10097;</button>
 				</div>
				<br>
				<div id="information">
					<div id="facility">
						<ion-icon name="bicycle-outline"></ion-icon>
					</div>
					<div id="pet">
						<ion-icon name="paw-outline"></ion-icon>
					</div>
					<div id="wireless">
						<ion-icon name="wifi-outline"></ion-icon>
					</div>
					<div id="park">
						<ion-icon name="car-sport-outline"></ion-icon>
					</div>
					<div id="height">
						<ion-icon name="trending-up-outline"></ion-icon>
					</div>
					<div id="operate">
						<ion-icon name="calendar-number-outline"></ion-icon>
					</div>
				</div>
				<div id="infoblock">
					<p id="campInfo"></p>
				</div>
				<img id="config" width="800" height="500"><br> <br>
				<div style="width:1000px;"><hr><FORM method="get" id="form1" onsubmit="return false"
					accept-charset="big5">
					<div class="formtoplace">入住日期:<input id="startdate" name="startdate" type="text" required></div>
					<div class="formtoplace">退房日期:<input id="enddate" name="enddate" type="text" required></div>
					<div class="formtoplace">人數:<input name="people" id="people" type="text" required></div>
					<div class="formtoplace"><input type="hidden" id="camp_no" name="camp_no">
					<input type="hidden" value="restart" name="action">
					<input type="button" id="restart" value="更改" class="btn btn-outline-success my-2 my-sm-0" style="margin-bottom:20px;"></div>
				</FORM><hr></div>
				<input id="stdt" name="startdate" type="hidden"> <input
					id="eddt" name="enddate" type="hidden"> <input name="pp"
					id="people" type="hidden">

				<div id="showplace">
					<table id="placeInfo"></table>
				</div>
				<div>
					<FORM method="post" id="order" onsubmit="return false"
						accept-charset="big5" style="display: none;">
						<table id="info">
							<tr>
								<td>日期</td>
								<td><input type="text" name="startdate" id="stdate"
									readonly="true">入住<br><input type="text"
									name="enddate" id="eddate" readonly="true">退房</td>
							</tr>
							<tr>
								<td>加購人數</td>
								<td><input type="text" name="ex_ppl" id="ex_ppl"
									readonly="true" value="0">人 200元/人</td>
							</tr>
							<tr>
								<td>總金額</td>
								<td><input type="text" name="total" id="total"
									readonly="true">元</td>
							</tr>
							<tr>
								<td>訂金</td>
								<td id="deposit"><input type="radio" name="deposit"
									value="0" required>全額付清<input type="radio"
									name="deposit" value="1">先付訂金</td>
							</tr>
							<tr id="useornot" style="display: none;">
								<td id="point">點數折抵</td>
								<td><input type="radio" name="point" value="0" required>使用<input
									type="radio" name="point" value="1" checked="checked">不使用</td>
							</tr>
							<tr>
								<td>付款方式</td>
								<td id="pay_meth"><input type="radio" name="pay_meth"
									value="0" required>信用卡<input type="radio"
									name="pay_meth" value="1">匯款</td>
							</tr>
							<tr>
								<td>發票方式</td>
								<td><input type="radio" name="receipt" value="0" required>紙本發票<input
									type="radio" name="receipt" value="1">電子發票<input
									type="radio" name="receipt" value="2">發票捐贈</td>
							</tr>
							<tr>
								<td>備註</td>
								<td><textArea name="rmk"></textArea></td>
							</tr>
							<tr>
								<td><input type="hidden" name="camp" id="camp"><input
									type="hidden" name="place" id="place"></td>
								<td><input type="button" id="send" value="送出" class="confirm"></td>
							</tr>
						</table>
					</FORM>
				</div>
				<div id="noteblock">
					<p id="note"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="modal" tabindex="-1" role="dialog" id="test1">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h3 class="modal-title" style="text-align: center;">訂單已成立</h3>
				</div>
				<div class="modal-body">
					<div id="edit">
						<div>
							<p id="atm">虛擬ATM帳戶:</p>
							<p id="ord_time"></p>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" id="done" value="確定"
						class="btn btn-secondary" data-dismiss="modal">確定</button>
				</div>
			</div>
		</div>
	</div>
	<script src="/CEA103G1/datetimepicker/jquery.js"></script>
	<script type="text/javascript" language="javascript" src="/CEA103G1/datetimepicker/jquery.datetimepicker.full.js" charset="UTF-8"></script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAS3FFLkorvfSYZ9kblu3kplAs2a1H8dO8"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"
		integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
		crossorigin="anonymous"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
		integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
		crossorigin="anonymous"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
		integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
		crossorigin="anonymous"></script>
	<script>
		 var slideIndex = 1;
		 showDivs(slideIndex);
		 function plusDivs(n) {
		 showDivs(slideIndex += n);
		  }
		 function showDivs(n) {
		 var i;
		 var x = document.getElementsByClassName("mySlides");
		 if (n > x.length) {slideIndex = 1} if (n < 1) {slideIndex = x.length}for
		 (i = 0; i < x.length; i++) {x[i].style.display = "none";}
		 x[slideIndex-1].style.display = "block"; }
	</script>
	<script>
	var locat = window.location.href;
	$.ajax({
		type : "GET",
		dataType : "json",
		url : "http://localhost:8081/CEA103G1/Member.do",
		data : {uri : locat},
		success : function(data) {
			
			if(data.length === 2){
				$('#have').css("display","none");
				$('#have1').css("display","none");
				$('#have2').css("display","none");
				$('#have3').css("display","none");
				$('#havent').css("display","inline-block");
				$('#havent2').css("display","inline-block");
			}else{
				let member_pic = `<img src="/CEA103G1/member/GetPhoto?mbr_no=${data.mbr_no}" class="person">`;
				$('#have2').after(`${data.name}`);
				$('#showPerson').append(member_pic);
				$('#have').css("display","inline-block");
				$('#have1').css("display","inline-block");
				$('#have2').css("display","inline-block");
				$('#have3').css("display","inline-block");
				$('#havent').css("display","none");
				$('#havent2').css("display","none");
			}
		}
	});
		var default1 = new Date();
		default1.setTime(default1.getTime()+24*60*60*1000); 
	    $.datetimepicker.setLocale('zh'); // kr ko ja en
	    $('#st').datetimepicker({
	       theme: '',          //theme: 'dark',
	       timepicker: false,   //timepicker: false,
	       step: 1,            //step: 60 (這是timepicker的預設間隔60分鐘)
	       format: 'Y-m-d',
	//	       value: default1,
	//        disabledDates:    ['2017/06/08','2017/06/09','2017/06/10'], // 去除特定不含
	       startDate:	        default1,  // 起始日
	       minDate:           '-1969-12-31', // 去除今日(不含)之前
	       //maxDate:           '+1970-01-01'  // 去除今日(不含)之後
	    });
	    $('#startdate').datetimepicker({
	       theme: '',          //theme: 'dark',
	       timepicker: false,   //timepicker: false,
	       step: 1,            //step: 60 (這是timepicker的預設間隔60分鐘)
	       format: 'Y-m-d',
	//	       value: default1,
	//        disabledDates:    ['2017/06/08','2017/06/09','2017/06/10'], // 去除特定不含
	       startDate:	        default1,  // 起始日
	       minDate:           '-1969-12-31', // 去除今日(不含)之前
	       //maxDate:           '+1970-01-01'  // 去除今日(不含)之後
	    });
		
		default1.setTime(default1.getTime()+24*60*60*1000); 
	    $.datetimepicker.setLocale('zh'); // kr ko ja en
	    $('#ed').datetimepicker({
	       theme: '',          //theme: 'dark',
	       timepicker: false,   //timepicker: false,
	       step: 1,            //step: 60 (這是timepicker的預設間隔60分鐘)
	       format: 'Y-m-d',
	//	       value: default1,
	//        disabledDates:    ['2017/06/08','2017/06/09','2017/06/10'], // 去除特定不含
	       startDate:	        default1,  // 起始日
	       minDate:           '-1969-12-30', // 去除今日(不含)之前
	       //maxDate:           '+1970-01-01'  // 去除今日(不含)之後
	    });
	    $('#enddate').datetimepicker({
	       theme: '',          //theme: 'dark',
	       timepicker: false,   //timepicker: false,
	       step: 1,            //step: 60 (這是timepicker的預設間隔60分鐘)
	       format: 'Y-m-d',
	//	       value: default1,
	//        disabledDates:    ['2017/06/08','2017/06/09','2017/06/10'], // 去除特定不含
	       startDate:	        default1,  // 起始日
	       minDate:           '-1969-12-30', // 去除今日(不含)之前
	       //maxDate:           '+1970-01-01'  // 去除今日(不含)之後
	    });
		$.ajax({
			type : "GET",
			dataType : "json",
			url : "http://localhost:8081/CEA103G1/district/district.do",
			success : function(data) {
				showDistrict(data);
			}
		});
	
		function showDistrict(data) {
			for (i in data) {
				var opt = $("<option>").val(data[i]).text(data[i]);
				$("#c").append(opt);
			}
		}
		const url = window.location.href;
		const splitUrl = url.split('?');
		const query = splitUrl[1];
		if(!query.includes("action")){
			const eachQuery = query.split('&');
			const camp = eachQuery[0].split('=');
			const startdate = eachQuery[1].split('=');
			const enddate = eachQuery[2].split('=');
			const people = eachQuery[3].split('=');
			$('#startdate').val(startdate[1]);
			$('#enddate').val(enddate[1]);
			$('#people').val(people[1]);
			sessionStorage.setItem("people", people[1]);
			sessionStorage.setItem("startdate", startdate[1]);
			sessionStorage.setItem("enddate", enddate[1]);
			const src = "/CEA103G1/camp/campconfig.do?camp_no=" + camp[1];
			$('#config').attr("src", src);
			$.ajax({
				type : "GET",
				dataType : "json",
				url : "http://localhost:8081/CEA103G1/campsite/CampInfo.do?"
						+ query,
				success : function(data) {
					initMap(data);
					showCamp(data);
					showPlace(data);
					showFeature(data);
					showPhoto(data);
					near(data);
				}
			});
		}else{
			const src = "/CEA103G1/camp/campconfig.do?" + query;
			const eachQuery = query.split('&');
			$('#config').attr("src", src);
			$('#restart').attr("value", "查詢營位");
			$('#restart').attr("id", "search");
			$.ajax({
				type : "GET",
				dataType : "json",
				url : "http://localhost:8081/CEA103G1/campsite/CampInfo.do?"
						+ query,
				success : function(data) {
					initMap(data);
					showCamp(data);
					showFeature(data);
					showPhoto(data);
					near(data);
				}
			});
		}
		function showCamp(data) {
			if(data[data.length-1].length===0){
				$('#photo').css("display","none");
			}
			$('#camp_no').val(`${data[0].camp_no}`);
			$('#title').text(`${data[0].camp_name}`);
			$('#address').text(`地址:${data[0].address}   `);
			$('#location').text(`位置:${data[0].latitude}, ${data[0].longitude}`);
			$('#facility').append(`設施:${data[0].facility}`);
			$('#park').append(`停車方式:${data[0].park}`);
			$('#wireless').append(`無線通訊:${data[0].wireless}`);
			let height = parseInt(`${data[0].height}`);
			height = "海拔" + height + "m";
			$('#height').append(height);
			if ('${data[0].pet}' === 0) {
				$('#pet').append(`寵物:不可攜帶`);
			} else {
				$('#pet').append(`寵物:可攜帶`);
			}
			if ('${data[0].operate_Date}' === 0) {
				$('#operate').append(`營業日:只有平日`);
			} else if ('${data[0].operate_Date}' === 1) {
				$('#operate').append(`營業日:只有假日`);
			} else {
				$('#operate').append(`營業日:平、假日`);
			}
			var campInfo = `${data[0].campInfo}`;
			campInfo = campInfo.replaceAll('\n', '<br>')
			var note = `${data[0].note}`;
			note = note.replaceAll('\n', '<br>')
			$('#campInfo').html(campInfo);
			$('#note').html(note);
			if(`${data[0].collected}` == 0){
				$("#fav").attr("name","bookmark");
			} else {
				$("#fav").attr("name","bookmark-outline");
			}

		}
		function showPhoto(data) {
			let count = 1;
			for(i in data[data.length-1]){
				let alt = "custom_html_banner" + count;
				let img = `<img class="mySlides" alt="${alt}" src="${data[data.length-1][i]}" style="width:100%;height:100%">`;
				$('#photo').append(img);
				$('#photo').find('img').each(function() {
					if(!($(this).attr("alt") === "custom_html_banner1")){
						$(this).css("display","none");
					}
				});
				count++;
			}
		}
		function near(data) {
			var locat = `${data[0].latitude}, ${data[0].longitude}`;
			$.ajax({
				type : "GET",
				dataType : "json",
				url : "http://localhost:8081/CEA103G1/near.do?locat="
						+ locat,
				success : function(spot) {
					for(i in spot){
						let html = `<a>${spot[i].name}</a><br>`;
						$('#spot').append(html);
					}
				}
			});
		}
		$("#search").click(function(){
			let start = Date.parse($('#startdate').val()).valueOf();
	    	let end = Date.parse($('#enddate').val()).valueOf();
	    	if (start >= end) {
				alert("入住日期不得大於或等於退房日期");
				return false;
			};
			$('#placeInfo').empty();
			$('#order').css("display","none");
				$.ajax({
					type : "GET",
					dataType : "json",
					url : "http://localhost:8081/CEA103G1/campsite/CampInfo.do",
					data : $('#form1').serialize(),
					success : function(data) {
						showPlace(data);
					}
				});
				$('#search').attr("value", "更改");
				$('#search').attr("id", "restart");
				sessionStorage.setItem("people", $('#people').val());
				sessionStorage.setItem("startdate", $('#startdate').val());
				sessionStorage.setItem("enddate", $('#enddate').val());
				let split = url.split('action');
				window.history.pushState({}, document.title, split[0] + "startdate=" + $('#startdate').val() + "&enddate=" + $('#enddate').val() + "&people=" + $('#people').val());
		});
		$("#restart").click(function(){
			let start = Date.parse($('#startdate').val()).valueOf();
	    	let end = Date.parse($('#enddate').val()).valueOf();
	    	if (start >= end) {
				alert("入住日期不得大於或等於退房日期");
				return false;
			};
				$('#placeInfo').empty();
				$('#order').css("display","none");
				$.ajax({
					type : "GET",
					dataType : "json",
					url : "http://localhost:8081/CEA103G1/campsite/CampInfo.do",
					data : $('#form1').serialize(),
					success : function(data) {
						showPlace(data);
					}
				});
				if(!($('#people').val()==="")){
					sessionStorage.setItem("people", $('#people').val());					
				}
				if(!($('#startdate').val()==="")|| !($('#enddate').val()==="")){
					sessionStorage.setItem("startdate", $('#startdate').val());				
					sessionStorage.setItem("enddate", $('#enddate').val());					
				}
				let split = url.split('&');
				window.history.pushState({}, document.title, url.substring(0,url.indexOf('&')+1) + "startdate=" + $('#startdate').val() + "&enddate=" + $('#enddate').val() + "&people=" + $('#people').val());
		});
		var map;
		function initMap(data) {
			var latitude = `${data[0].latitude}`;
			var longitude = `${data[0].longitude}`;
			console.log(latitude, longitude);
			map = new google.maps.Map(document.getElementById('map'), {
				center : {
					lat : parseFloat(latitude),
					lng : parseFloat(longitude)
				},
				zoom : 14,
			});
			var position = {
				lat : parseFloat(latitude),
				lng : parseFloat(longitude)
			};
			var marker = new google.maps.Marker({
				position : position,
				map : map
			});
		}
		$("#fav").click(function(){
			if($("#fav").attr("name") === "bookmark-outline"){
				$.ajax({
					type : "GET",
					url : "http://localhost:8081/CEA103G1/campsite_colection/collection.do?action=add&camp_no=" + $('#camp_no').val(),
					success : function(data) {
						alert(data);
						$("#fav").attr("name","bookmark");
					}
				});
			}else{
				$.ajax({
					type : "GET",
					url : "http://localhost:8081/CEA103G1/campsite_colection/collection.do?action=delete&camp_no=" + $('#camp_no').val(),
					success : function(data) {
						alert(data);
						$("#fav").attr("name","bookmark-outline");
					}
				});
			}
		});

		function showFeature(data){
			if(data.length === 4){
				for(i in data[2]){
					let html;
					html =`<button value="${data[2][i].camp_fl_no}" onclick="findWithFeature(this.value)" class="confirm">${data[2][i].camp_fl_name}</button>`;
					$('#featurelist').append(html);
				}
			}else{
				for(i in data[1]){
					let html;
					html =`<button value="${data[1][i].camp_fl_no}" onclick="findWithFeature(this.value)" class="confirm">${data[1][i].camp_fl_name}</button>`;
					$('#featurelist').append(html);
				}
			}
		}
		
		function findWithFeature(e) {
			window.location.href="http://localhost:8081/CEA103G1/front-end/campsite/listAllCamp.html?camp_fl_no=" + e;
		}

		$("#backtobrowse").click(function(){
			let start = Date.parse($('#st').val()).valueOf();
	    	let end = Date.parse($('#ed').val()).valueOf();
	    	if (start >= end) {
				alert("入住日期不得大於或等於退房日期");
				return false;
			};
			let st = $('#st').val();
			let ed = $('#ed').val();
			let p = $('#p').val();
			let c = $('#c').val();
			sessionStorage.setItem('county',c)
			window.location.href="http://localhost:8081/CEA103G1/front-end/campsite/listAllCamp.html?startdate=" + st + "&enddate=" + ed + "&people=" + p;
		});
		
		function showPlace(data){
			let html;
			$('#placeInfo').append(`<tr><th>名稱</th><th>人數</th><th>人數上限</th><th>平日價格</th><th>假日價格</th><th>選取</th><th>入住金額</th></tr>`);
			if(data[1]){
				for(i in data[1]){
					html = `<tr class="checkBoxChecked"><td>${data[1][i].plc_name}</td><td>${data[1][i].ppl}</td><td>${data[1][i].max_ppl}</td>
					<td>${data[1][i].pc_wkdy}</td><td>${data[1][i].pc_wknd}</td><td><input type="checkbox" name="getprice" value="${data[1][i].plc_no}"></td><td class="pc"></td></tr>`;
			    	$('#placeInfo').append(html);
				}
				$('#placeInfo').append(`<tr><td colspan="6"><input class="confirm" type="button" id="add" value="我要下訂" disabled="true"></td><td id="sum">0</td></tr>`);
			}else{
				$('#placeInfo').after("<p>查無營位</p>");
			}
		}

		$("#placeInfo").click(function(){
			if($("#placeInfo input:checked").length===0){
				$('#add').attr("disabled",true);
				$('#send').attr("disabled",true);
			}else{
				$('#add').attr("disabled",false);
				$('#send').attr("disabled",false);
			}
				let start = Date.parse(sessionStorage.getItem('startdate'));
				let end = Date.parse(sessionStorage.getItem('enddate'));
	  			let interval = new Array();
	  			let days = new Array();
	  			let aday = 0;
  				while(!(interval[interval.length - 1]===end)){
  					interval.push(start+aday);
  					aday+=24*60*60*1000;
  				};
            	for(let i = 0; i < interval.length-1; i++){
            		days.push(new Date(interval[i]).getDay());
           		 }
            	let wknd = 0;
            	let wkdy = 0;
           		for(let i = 0; i < days.length; i++){
            		if(days[i]===5 || days[i]===6){
            			wknd++;
            		}else{
            			wkdy++;
            		}
          		}
           		let chosen="";
           		let ppl = sessionStorage.getItem('people');
//            		let ppl = $('#people').val();
           		let roomppl = 0;
           		let max_ppl = 0;
				$("#placeInfo input:checked").each(function() {
					let dypc = $(this).parent().prev().prev().text();
					let ndpc = $(this).parent().prev().text();
					let pc = dypc*wkdy + ndpc*wknd;
					$(this).parent().next().text(pc);
					chosen += ($(this).val() + ",");
					roomppl+=parseInt($(this).parent().prev().prev().prev().prev().text());
					max_ppl+=parseInt($(this).parent().prev().prev().prev().text());
		 		});
				if((ppl-roomppl)>0){
					if((ppl-max_ppl)>0){
						$('#add').attr("disabled",true);
						$('#send').attr("disabled",true);
						$('#ex_ppl').val("");
					}else{
						let ex_ppl = Math.abs(ppl-roomppl);
						$('#ex_ppl').val(ex_ppl);
					}
				}else{
					$('#add').attr("disabled",false);
					$('#send').attr("disabled",false);
					$('#ex_ppl').val(0);
				}
				$('#place').val(chosen);
				$("#placeInfo input:checkbox:not(:checked)").each(function() {
					$(this).parent().next().text("");
		 		});
				let total = 0;
				$(".pc").each(function() {
					total += Number($(this).text());
		 		});
				$("#sum").text(total);
				let ex_pc = $('#ex_ppl').val()*200;
				total+=ex_pc;
				$("#total").val(total);
			
		});

		$("#placeInfo").on('click','#add',function(){
			$('#add').attr("disabled",true);
			$('#order').css("display", "block");
			$('#stdate').val(sessionStorage.getItem('startdate'));
			$('#eddate').val(sessionStorage.getItem('enddate'));
			$('#camp').val($('#camp_no').val());
			var locat = window.location.href;
			$.ajax({
				type : "GET",
				dataType : "json",
				url : "http://localhost:8081/CEA103G1/Member.do",
				data : {uri : locat},
				success : function(data) {
					if(data.length === 2){
						alert(data[0]);
						window.location.href=data[1];
					}else{
						let html;
						html=`<tr><td>姓名</td><td><input type="text" readonly="true" value="${data.name}"><input type="hidden" name="member" value="${data.mbr_no}"></td></tr>`;
						$('#info').prepend(html);
						$('#point').append(`(剩餘${data.pt}點)`);
					}
				}
			});
		});
// 		$("input[name='gender']:checked").val() $("input[name*='deposit'][value='0']").attr("checked", true);
		$("#deposit").children().change(function(){
			if($("input[name='deposit']:checked").val()==="0"){
				$("#useornot").css("display","");
			}else{
				$("#useornot").css("display","none");
				$("input[name='point'][value='1']").prop("checked", true);
			}
		});
		$("#send").click(function(){
			if($("input[name='pay_meth']:checked").val()==="0"){
				$.ajax({
					type : "POST",
					url : "http://localhost:8081/CEA103G1/place_order/Place_order.do?action=creditcard",
					data : $('#order').serialize(),
					success : function(data) {
						let ord = JSON.stringify(data);
						sessionStorage.setItem("ord", ord);
						window.location.href="http://localhost:8081/CEA103G1/front-end/place_order/creditCard.html";
					}
				});
			} else{
				$.ajax({
					type : "POST",
					url : "http://localhost:8081/CEA103G1/place_order/Place_order.do?action=transfer",
					data : $('#order').serialize(),
					success : function(data) {
						showModal1(data)
						
					}
				});
			}
		});
		function showModal1(data) {
			var place_ord = data[0];
			var ord_time = Date.parse(`${place_ord.plc_ord_time}`);
			var deadline = new Date(ord_time + (30*60*1000));
			
			var message = "請於" + deadline + "匯款完畢，逾時取消訂單";
			$('#ord_time').append(message);
			var atm = data[1];
			$('#atm').append(atm);
			$('#test1').modal('show');
		}
		$("#done").click(function() {
			location.reload()
		});
	</script>
	<script>
		let countMenu = 0;
		function showMenu() {
			countMenu++;
			if (countMenu % 2 == 1) {
				let secArray = document.getElementsByClassName("sec");
				for (let i = 0; i < secArray.length; i++) {
					secArray[i].style.display = "flex";
				}
			} else {
				let secArray = document.getElementsByClassName("sec");
				for (let i = 0; i < secArray.length; i++) {
					secArray[i].style.display = "none";
				}
			}
		}

		let countSearch = 0;
		function showSearch() {
			countSearch++;
			if (countSearch % 2 == 1) {
				let formArray = document.getElementsByClassName("secSearch");
				for (let i = 0; i < formArray.length; i++) {
					formArray[i].style.display = "flex";
				}
			} else {
				let formArray = document.getElementsByClassName("secSearch");
				for (let i = 0; i < formArray.length; i++) {
					formArray[i].style.display = "none";
				}
			}
		}
	</script>
</body>
</html>